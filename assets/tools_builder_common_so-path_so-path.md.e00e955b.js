import{_ as l,r as p,o,c as e,a as c,b as F}from"./app.21cc2de4.js";const E=JSON.parse('{"title":"动态库路径问题","description":"","frontmatter":{},"headers":[{"level":2,"title":"1. 背景","slug":"_1-背景","link":"#_1-背景","children":[]},{"level":2,"title":"2. 编译时","slug":"_2-编译时","link":"#_2-编译时","children":[{"level":3,"title":"2.1 链接器的默认搜索路径","slug":"_2-1-链接器的默认搜索路径","link":"#_2-1-链接器的默认搜索路径","children":[]},{"level":3,"title":"2.2 链接时指定的的搜索路径","slug":"_2-2-链接时指定的的搜索路径","link":"#_2-2-链接时指定的的搜索路径","children":[]}]},{"level":2,"title":"3. 运行时","slug":"_3-运行时","link":"#_3-运行时","children":[{"level":3,"title":"3.1 运行时搜索库的路径","slug":"_3-1-运行时搜索库的路径","link":"#_3-1-运行时搜索库的路径","children":[]},{"level":3,"title":"3.2 使用LD_LIBRARY_PATH","slug":"_3-2-使用ld-library-path","link":"#_3-2-使用ld-library-path","children":[]}]},{"level":2,"title":"4. 编译时和运行时动态库路径关系","slug":"_4-编译时和运行时动态库路径关系","link":"#_4-编译时和运行时动态库路径关系","children":[]}],"relativePath":"tools/builder/common/so-path/so-path.md"}'),r={name:"tools/builder/common/so-path/so-path.md"};function t(n,s,y,i,d,b){const a=p("Vssue");return o(),e("div",null,[s[0]||(s[0]=c(`<h1 id="动态库路径问题" tabindex="-1">动态库路径问题 <a class="header-anchor" href="#动态库路径问题" aria-hidden="true">#</a></h1><hr><table><thead><tr><th>软件版本</th><th>硬件版本</th><th>更新内容</th></tr></thead><tbody><tr><td></td><td></td><td></td></tr></tbody></table><hr><h2 id="_1-背景" tabindex="-1">1. 背景 <a class="header-anchor" href="#_1-背景" aria-hidden="true">#</a></h2><p>动态库的使用带来了很多好处，比如大大降低程序所使用磁盘空间，内存空间，这个是曾经系统配置比较低的时代意义重大，还有很多其他的好处，请自行查阅。但是给程序员编译，运行程序都带来一些困惑，这里很通过这片文章将动态库路径问题彻底说明白。</p><h2 id="_2-编译时" tabindex="-1">2. 编译时 <a class="header-anchor" href="#_2-编译时" aria-hidden="true">#</a></h2><h3 id="_2-1-链接器的默认搜索路径" tabindex="-1">2.1 链接器的默认搜索路径 <a class="header-anchor" href="#_2-1-链接器的默认搜索路径" aria-hidden="true">#</a></h3><p>编译时使用<code>ld</code>来连接，链接器是根据连接脚本来工作的，所以它搜索动态库时也是根据链接脚本里<code>SEARCH_DIR</code>指定的地址来搜索需要连接的库。链接脚本在ubuntu中位于<code>/usr/lib/x86_64-linux-gnu/ldscripts</code></p><div class="language-c line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F8F8F2;">ld </span><span style="color:#F92672;">--</span><span style="color:#F8F8F2;">verbose </span><span style="color:#F92672;">|</span><span style="color:#F8F8F2;"> grep SEARCH </span><span style="color:#F92672;">|</span><span style="color:#F8F8F2;"> sed </span><span style="color:#E6DB74;">&#39;s/;[ ]/</span><span style="color:#AE81FF;">\\n</span><span style="color:#E6DB74;">/g&#39;</span></span>
<span class="line"><span style="color:#A6E22E;">SEARCH_DIR</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;=/usr/local/lib/x86_64-linux-gnu&quot;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#A6E22E;">SEARCH_DIR</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;=/lib/x86_64-linux-gnu&quot;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#A6E22E;">SEARCH_DIR</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;=/usr/lib/x86_64-linux-gnu&quot;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#A6E22E;">SEARCH_DIR</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;=/usr/lib/x86_64-linux-gnu64&quot;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#A6E22E;">SEARCH_DIR</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;=/usr/local/lib64&quot;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#A6E22E;">SEARCH_DIR</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;=/lib64&quot;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#A6E22E;">SEARCH_DIR</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;=/usr/lib64&quot;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#A6E22E;">SEARCH_DIR</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;=/usr/local/lib&quot;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#A6E22E;">SEARCH_DIR</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;=/lib&quot;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#A6E22E;">SEARCH_DIR</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;=/usr/lib&quot;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#A6E22E;">SEARCH_DIR</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;=/usr/x86_64-linux-gnu/lib64&quot;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#A6E22E;">SEARCH_DIR</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;=/usr/x86_64-linux-gnu/lib&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_2-2-链接时指定的的搜索路径" tabindex="-1">2.2 链接时指定的的搜索路径 <a class="header-anchor" href="#_2-2-链接时指定的的搜索路径" aria-hidden="true">#</a></h3><h4 id="_2-2-1-通过-l" tabindex="-1">2.2.1 通过<code>-L</code> <a class="header-anchor" href="#_2-2-1-通过-l" aria-hidden="true">#</a></h4><p>通过<code>gcc</code>编译时可以通过<code>-L</code>的增加库的搜索路径，这里引用<code>gcc</code>帮忙文档的话如下：</p><blockquote><p>-Ldir <br>     Add directory dir to the list of directories to be searched for -l.</p></blockquote><p>这里增加的库搜索路径不是给<code>gcc</code>使用的，而是给<code>ld</code>使用的。</p><h4 id="_2-2-1-通过ld-run-path" tabindex="-1">2.2.1 通过<code>LD_RUN_PATH</code> <a class="header-anchor" href="#_2-2-1-通过ld-run-path" aria-hidden="true">#</a></h4><p>通过设置<code>LD_RUN_PATH</code>环境变量来添加库搜索路径。</p><h2 id="_3-运行时" tabindex="-1">3. 运行时 <a class="header-anchor" href="#_3-运行时" aria-hidden="true">#</a></h2><h3 id="_3-1-运行时搜索库的路径" tabindex="-1">3.1 运行时搜索库的路径 <a class="header-anchor" href="#_3-1-运行时搜索库的路径" aria-hidden="true">#</a></h3><p>运行时，库的装载分为显式装载和隐式装载，显示装载是由程序本身通过通过动态库接口<code>dlopen dlsys</code>来完成的，不存在路径问题，我们这主要讨论隐式的装载，隐式装载是由<code>/lib/x86_64-linux-gnu/ld-2.31.so</code>完成的。</p><p>对于一个<code>ELF</code>文件，如果存在<code>.interp</code>段那么就是动态连接的程序，在<code>.interp</code>存放的就是动态链接器，如果没有<code>.interp</code>那么就是静态连接的程序。 在我们在<code>linux</code>下执行一个动态连接的程序时，内核根据不关心些<code>ELF</code>是否是一个可执行的程序，加载完<code>ELF</code>文件后，内核会分析<code>ELF</code>是否存在<code>.interp</code>段，如果不存在会跳到ELF的<code>e_entry</code>执行，这就是静态链接程序的执行，如果存在，会将<code>.interp</code> 段的链接器映射到进程地址空间，再跳到动态链接器的<code>e_entry</code>地址执行，动态链接器会根据<code>.dynamic</code>段来加载动态库。</p><p>那么动态连接器会从那些路径搜索动态库？会从<code>/etc/ld.so.conf</code>指定的路径的去搜索。我们<code>ubuntu</code>机器的配置如下</p><div class="language-cmd line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cmd</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F92672;">=&gt;</span><span style="color:#F8F8F2;"> cat  /etc/ld.so.conf</span></span>
<span class="line"><span style="color:#F8F8F2;">include /etc/ld.so.conf.d/</span><span style="color:#F92672;">*</span><span style="color:#F8F8F2;">.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">=&gt;</span><span style="color:#F8F8F2;"> ls /etc/ld.so.conf.d/</span><span style="color:#F92672;">*</span></span>
<span class="line"><span style="color:#F8F8F2;">/etc/ld.so.conf.d/fakeroot</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">x86_64</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">linux</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">gnu.conf  /etc/ld.so.conf.d/x86_64</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">linux</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">gnu.conf       /etc/ld.so.conf.d/zz_x32</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">biarch</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">compat.conf</span></span>
<span class="line"><span style="color:#F8F8F2;">/etc/ld.so.conf.d/libc.conf                       /etc/ld.so.conf.d/zz_i386</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">biarch</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">compat.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">=&gt;</span><span style="color:#F8F8F2;"> cat /etc/ld.so.conf.d/x86_64</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">linux</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">gnu.conf</span></span>
<span class="line"><span style="color:#F8F8F2;"># Multiarch support</span></span>
<span class="line"><span style="color:#F8F8F2;">/usr/local/lib/x86_64</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">linux</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">gnu</span></span>
<span class="line"><span style="color:#F8F8F2;">/lib/x86_64</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">linux</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">gnu</span></span>
<span class="line"><span style="color:#F8F8F2;">/usr/lib/x86_64</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">linux</span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">gnu</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_3-2-使用ld-library-path" tabindex="-1">3.2 使用<code>LD_LIBRARY_PATH</code> <a class="header-anchor" href="#_3-2-使用ld-library-path" aria-hidden="true">#</a></h3><p>使用<code>LD_LIBRARY_PATH</code>可以增加<code>/lib/x86_64-linux-gnu/ld-2.31.so</code>的搜索路径。</p><h2 id="_4-编译时和运行时动态库路径关系" tabindex="-1">4. 编译时和运行时动态库路径关系 <a class="header-anchor" href="#_4-编译时和运行时动态库路径关系" aria-hidden="true">#</a></h2><p>按目前了解的信息，除了一个<code>特殊情况</code>基本不存在关系，对于链接时，只要<code>ld</code>能从搜索库的路径找到库就可以编译通过，它不关系运行时是否可以找到，运行时也一样，只要<code>ld-2.31.so</code>可以从<code>/etc/ld.so.conf</code>指定的路径中找到就可以正确运行。</p><p><code>特殊情况</code>是，在链接是<code>ld</code>使用<code>rpath</code>指定的一个库的路径然后时行连接，执行运行时<code>ld-2.31.so</code>,会从指定的那个路径查找库,</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><ol><li><code>rpath</code> 指定的路径不会作为<code>ld</code>搜索路径</li><li><code>ld-2.31.so</code>从指定没有找到，也会从默认的搜索路径中找</li></ol></div><p>这块关系比较复杂，通过一个示例来说明：</p><p>源文件 <code>add.c</code></p><div class="language-c line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki monokai"><code><span class="line"><span style="color:#66D9EF;font-style:italic;">int</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">add</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">int</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;font-style:italic;">a</span><span style="color:#F8F8F2;">, </span><span style="color:#66D9EF;font-style:italic;">int</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;font-style:italic;">b</span><span style="color:#F8F8F2;">){</span></span>
<span class="line"><span style="color:#F8F8F2;">	</span><span style="color:#F92672;">return</span><span style="color:#F8F8F2;"> a </span><span style="color:#F92672;">+</span><span style="color:#F8F8F2;"> b;</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>我们把<code>add.c</code>通过<code>gcc -o libadd.so -shared -fPIC ./add.c</code> 编译成<code>libadd.so</code> , 然后放到<code>lib</code>下。</p><p>再编写接口文件 <code>add.h</code></p><div class="language-c line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F92672;">#ifndef</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">__ADD_H__</span></span>
<span class="line"><span style="color:#F92672;">#define</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">__ADD_H__</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">int</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">add</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">int</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;font-style:italic;">a</span><span style="color:#F8F8F2;">, </span><span style="color:#66D9EF;font-style:italic;">int</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;font-style:italic;">b</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">#endif</span><span style="color:#88846F;"> /* ADD_H */</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>再编译测试程序 <code>test.c</code></p><div class="language-c line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F92672;">#ifndef</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">__ADD_H__</span></span>
<span class="line"><span style="color:#F92672;">#define</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">__ADD_H__</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">int</span><span style="color:#F8F8F2;"> </span><span style="color:#A6E22E;">add</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">int</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;font-style:italic;">a</span><span style="color:#F8F8F2;">, </span><span style="color:#66D9EF;font-style:italic;">int</span><span style="color:#F8F8F2;"> </span><span style="color:#FD971F;font-style:italic;">b</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">#endif</span><span style="color:#88846F;"> /* ADD_H */</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>此时的文件结构如下：</p><div class="language-c line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F92672;">=&gt;</span><span style="color:#F8F8F2;"> ls</span></span>
<span class="line"><span style="color:#F8F8F2;">add.c  add.h  lib  test.c</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol><li>通过<code>gcc -o test test.c -ladd -Wl,--rpath=./lib -L ./lib</code> 编译</li></ol><div class="language-c line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F92672;">=&gt;</span><span style="color:#F8F8F2;"> readelf </span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">d .</span><span style="color:#F92672;">/</span><span style="color:#F8F8F2;">test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">Dynamic section at offset </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">2db0</span><span style="color:#F8F8F2;"> contains </span><span style="color:#AE81FF;">28</span><span style="color:#F8F8F2;"> entries:</span></span>
<span class="line"><span style="color:#F8F8F2;">  Tag        Type                         Name</span><span style="color:#F92672;">/</span><span style="color:#F8F8F2;">Value</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000001</span><span style="color:#F8F8F2;"> (NEEDED)             Shared library: [libadd.so]</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000001</span><span style="color:#F8F8F2;"> (NEEDED)             Shared library: [libc.so.</span><span style="color:#AE81FF;">6</span><span style="color:#F8F8F2;">]</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000000c</span><span style="color:#F8F8F2;"> (INIT)               </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">1000</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000000d</span><span style="color:#F8F8F2;"> (FINI)               </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">1238</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000019</span><span style="color:#F8F8F2;"> (INIT_ARRAY)         </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">3da0</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000001b</span><span style="color:#F8F8F2;"> (INIT_ARRAYSZ)       </span><span style="color:#AE81FF;">8</span><span style="color:#F8F8F2;"> (bytes)</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000001a</span><span style="color:#F8F8F2;"> (FINI_ARRAY)         </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">3da8</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000001c</span><span style="color:#F8F8F2;"> (FINI_ARRAYSZ)       </span><span style="color:#AE81FF;">8</span><span style="color:#F8F8F2;"> (bytes)</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000006ffffef5</span><span style="color:#F8F8F2;"> (GNU_HASH)           </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">3a0</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000005</span><span style="color:#F8F8F2;"> (STRTAB)             </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">488</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000006</span><span style="color:#F8F8F2;"> (SYMTAB)             </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">3c8</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000000a</span><span style="color:#F8F8F2;"> (STRSZ)              </span><span style="color:#AE81FF;">146</span><span style="color:#F8F8F2;"> (bytes)</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000000b</span><span style="color:#F8F8F2;"> (SYMENT)             </span><span style="color:#AE81FF;">24</span><span style="color:#F8F8F2;"> (bytes)</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000015</span><span style="color:#F8F8F2;"> (DEBUG)              </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000003</span><span style="color:#F8F8F2;"> (PLTGOT)             </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">3fb0</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000002</span><span style="color:#F8F8F2;"> (PLTRELSZ)           </span><span style="color:#AE81FF;">48</span><span style="color:#F8F8F2;"> (bytes)</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000014</span><span style="color:#F8F8F2;"> (PLTREL)             RELA</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000017</span><span style="color:#F8F8F2;"> (JMPREL)             </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">610</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000007</span><span style="color:#F8F8F2;"> (RELA)               </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">550</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000008</span><span style="color:#F8F8F2;"> (RELASZ)             </span><span style="color:#AE81FF;">192</span><span style="color:#F8F8F2;"> (bytes)</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000009</span><span style="color:#F8F8F2;"> (RELAENT)            </span><span style="color:#AE81FF;">24</span><span style="color:#F8F8F2;"> (bytes)</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000001e</span><span style="color:#F8F8F2;"> (FLAGS)              BIND_NOW</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000006ffffffb</span><span style="color:#F8F8F2;"> (FLAGS_1)            Flags: NOW PIE</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000006ffffffe</span><span style="color:#F8F8F2;"> (VERNEED)            </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">530</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000006fffffff</span><span style="color:#F8F8F2;"> (VERNEEDNUM)         </span><span style="color:#AE81FF;">1</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000006ffffff0</span><span style="color:#F8F8F2;"> (VERSYM)             </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">51a</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000006ffffff9</span><span style="color:#F8F8F2;"> (RELACOUNT)          </span><span style="color:#AE81FF;">3</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000000</span><span style="color:#F8F8F2;"> (</span><span style="color:#AE81FF;">NULL</span><span style="color:#F8F8F2;">)               </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><ol start="2"><li>通过<code>gcc -o test test.c -ladd -Wl,--rpath=./lib -L ./lib</code> 编译</li></ol><div class="language-c line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F92672;">=&gt;</span><span style="color:#F8F8F2;"> readelf </span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;">d .</span><span style="color:#F92672;">/</span><span style="color:#F8F8F2;">test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">Dynamic section at offset </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">2da0</span><span style="color:#F8F8F2;"> contains </span><span style="color:#AE81FF;">29</span><span style="color:#F8F8F2;"> entries:</span></span>
<span class="line"><span style="color:#F8F8F2;">  Tag        Type                         Name</span><span style="color:#F92672;">/</span><span style="color:#F8F8F2;">Value</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000001</span><span style="color:#F8F8F2;"> (NEEDED)             Shared library: [libadd.so]</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000001</span><span style="color:#F8F8F2;"> (NEEDED)             Shared library: [libc.so.</span><span style="color:#AE81FF;">6</span><span style="color:#F8F8F2;">]</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000001d</span><span style="color:#F8F8F2;"> (RUNPATH)            Library runpath: [.</span><span style="color:#F92672;">/</span><span style="color:#F8F8F2;">lib]</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000000c</span><span style="color:#F8F8F2;"> (INIT)               </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">1000</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000000d</span><span style="color:#F8F8F2;"> (FINI)               </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">1238</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000019</span><span style="color:#F8F8F2;"> (INIT_ARRAY)         </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">3d90</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000001b</span><span style="color:#F8F8F2;"> (INIT_ARRAYSZ)       </span><span style="color:#AE81FF;">8</span><span style="color:#F8F8F2;"> (bytes)</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000001a</span><span style="color:#F8F8F2;"> (FINI_ARRAY)         </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">3d98</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000001c</span><span style="color:#F8F8F2;"> (FINI_ARRAYSZ)       </span><span style="color:#AE81FF;">8</span><span style="color:#F8F8F2;"> (bytes)</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000006ffffef5</span><span style="color:#F8F8F2;"> (GNU_HASH)           </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">3a0</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000005</span><span style="color:#F8F8F2;"> (STRTAB)             </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">488</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000006</span><span style="color:#F8F8F2;"> (SYMTAB)             </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">3c8</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000000a</span><span style="color:#F8F8F2;"> (STRSZ)              </span><span style="color:#AE81FF;">152</span><span style="color:#F8F8F2;"> (bytes)</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000000b</span><span style="color:#F8F8F2;"> (SYMENT)             </span><span style="color:#AE81FF;">24</span><span style="color:#F8F8F2;"> (bytes)</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000015</span><span style="color:#F8F8F2;"> (DEBUG)              </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000003</span><span style="color:#F8F8F2;"> (PLTGOT)             </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">3fb0</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000002</span><span style="color:#F8F8F2;"> (PLTRELSZ)           </span><span style="color:#AE81FF;">48</span><span style="color:#F8F8F2;"> (bytes)</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000014</span><span style="color:#F8F8F2;"> (PLTREL)             RELA</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000017</span><span style="color:#F8F8F2;"> (JMPREL)             </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">610</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000007</span><span style="color:#F8F8F2;"> (RELA)               </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">550</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000008</span><span style="color:#F8F8F2;"> (RELASZ)             </span><span style="color:#AE81FF;">192</span><span style="color:#F8F8F2;"> (bytes)</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000009</span><span style="color:#F8F8F2;"> (RELAENT)            </span><span style="color:#AE81FF;">24</span><span style="color:#F8F8F2;"> (bytes)</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000000000001e</span><span style="color:#F8F8F2;"> (FLAGS)              BIND_NOW</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000006ffffffb</span><span style="color:#F8F8F2;"> (FLAGS_1)            Flags: NOW PIE</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000006ffffffe</span><span style="color:#F8F8F2;"> (VERNEED)            </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">530</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000006fffffff</span><span style="color:#F8F8F2;"> (VERNEEDNUM)         </span><span style="color:#AE81FF;">1</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000006ffffff0</span><span style="color:#F8F8F2;"> (VERSYM)             </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">520</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">000000006ffffff9</span><span style="color:#F8F8F2;"> (RELACOUNT)          </span><span style="color:#AE81FF;">3</span></span>
<span class="line"><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0000000000000000</span><span style="color:#F8F8F2;"> (</span><span style="color:#AE81FF;">NULL</span><span style="color:#F8F8F2;">)               </span><span style="color:#F92672;">0x</span><span style="color:#AE81FF;">0</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>对比两种编译方式<code>readelf -d test</code>的输出，使用<code>-rpath</code>在ELF文件中会存在一个<code> 0x000000000000001d (RUNPATH) Library runpath: [./lib]</code>,也就是增加了一个搜索路径。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>使用<code>rpath</code>指定路径最好使用绝对路径，这样库文件不会因为程序的执行路径找一到库。</p></div><hr><div class="tip custom-block"><p class="custom-block-title">提示</p><p>欢迎评论、探讨,如果发现错误请指正。转载请注明出处！ <a href="http://www.tsz.wiki" target="_blank" rel="noreferrer">探索者</a></p></div><hr>`,48)),F(a,{title:n.$title},null,8,["title"])])}const A=l(r,[["render",t]]);export{E as __pageData,A as default};
