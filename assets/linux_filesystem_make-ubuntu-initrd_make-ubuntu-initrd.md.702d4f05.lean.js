import{_ as l,r as p,o,c as e,a as r,b as c}from"./app.a2daf185.js";const t="/assets/test.4daac7ad.svg",D=JSON.parse('{"title":"制作UBUNTU根文件系统","description":"","frontmatter":{},"headers":[{"level":2,"title":"1.概述","slug":"_1-概述","link":"#_1-概述","children":[]},{"level":2,"title":"2.制作","slug":"_2-制作","link":"#_2-制作","children":[{"level":3,"title":"2.1 获取基础包","slug":"_2-1-获取基础包","link":"#_2-1-获取基础包","children":[]},{"level":3,"title":"2.2 配置","slug":"_2-2-配置","link":"#_2-2-配置","children":[]}]},{"level":2,"title":"3. 测试","slug":"_3-测试","link":"#_3-测试","children":[]},{"level":2,"title":"4. 小结","slug":"_4-小结","link":"#_4-小结","children":[]}],"relativePath":"linux/filesystem/make-ubuntu-initrd/make-ubuntu-initrd.md"}'),F={name:"linux/filesystem/make-ubuntu-initrd/make-ubuntu-initrd.md"};function y(n,s,i,u,b,E){const a=p("Vssue");return o(),e("div",null,[s[0]||(s[0]=r(`<h1 id="制作ubuntu根文件系统" tabindex="-1">制作UBUNTU根文件系统 <a class="header-anchor" href="#制作ubuntu根文件系统" aria-hidden="true">#</a></h1><hr><table><thead><tr><th>软件版本</th><th>硬件版本</th><th>更新内容</th></tr></thead><tbody><tr><td>ubuntu20.04</td><td>amd64</td><td></td></tr></tbody></table><hr><h2 id="_1-概述" tabindex="-1">1.概述 <a class="header-anchor" href="#_1-概述" aria-hidden="true">#</a></h2><p>之前的文章我们介绍过<a href="https://www.tsz.wiki/linux/filesystem/initrd-principles/initrd-principles.html" target="_blank" rel="noreferrer">根文件系统原理</a>,但是我们使用的 <code>rootfs</code> 是根据<code>busybox</code>制作来出的，但是这个<code>rootfs</code>过于简单，还有很多功能是没有的，今天基于<code>ubuntu</code>提供的base包来制作一个比较完善的<code>rootfs</code>,具备<code>apt install</code>、<code>systemd</code>等功能。</p><h2 id="_2-制作" tabindex="-1">2.制作 <a class="header-anchor" href="#_2-制作" aria-hidden="true">#</a></h2><h3 id="_2-1-获取基础包" tabindex="-1">2.1 获取基础包 <a class="header-anchor" href="#_2-1-获取基础包" aria-hidden="true">#</a></h3><p>从<a href="http://cdimage.ubuntu.com/ubuntu-base/releases/" target="_blank" rel="noreferrer">这里</a>,可以下载到各个版本的<code>ubuntu base</code>包，这里我用<code>20.04</code>为例，通过下面的方式来下载：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F8F8F2;">wget </span><span style="color:#E6DB74;">http://cdimage.ubuntu.com/ubuntu-base/releases/</span><span style="color:#AE81FF;">20.04</span><span style="color:#E6DB74;">/release/ubuntu-base-20.04.1-base-amd64.tar.gz</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>之后解压到<code>base</code>目录：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F8F8F2;">mkdir </span><span style="color:#E6DB74;">base</span></span>
<span class="line"><span style="color:#F8F8F2;">tar </span><span style="color:#AE81FF;">-xvf</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">./ubuntu-base-20.04.1-base-amd64.tar.gz</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-C</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">base</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>解压之后如所示，这就是最初的包，其实里面已经有很多功能，比如软件安装功能等等</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F8F8F2;">ls </span><span style="color:#E6DB74;">./base</span></span>
<span class="line"><span style="color:#F8F8F2;">bin  </span><span style="color:#E6DB74;">boot</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">dev</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">etc</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">home</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">lib</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">lib32</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">lib64</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">libx32</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">media</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">mnt</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">opt</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">proc</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">root</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">run</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">sbin</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">srv</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">sys</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">tmp</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">usr</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">var</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2-2-配置" tabindex="-1">2.2 配置 <a class="header-anchor" href="#_2-2-配置" aria-hidden="true">#</a></h3><ol><li>配置DNS,这里我们直接我电脑里的解析文件，我这边是<code>ubuntu</code>,DNS文件在<code>/etc/resolv.conf</code></li></ol><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F8F8F2;">cp </span><span style="color:#E6DB74;">/etc/resolv.conf</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">./base/etc</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>切换系统根目录 通过下面的指令就可以切换系统根目录到<code>base</code>目录</li></ol><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F8F8F2;">sudo </span><span style="color:#E6DB74;">chroot</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">base</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">/bin/bash</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">Tip</p><p>后面加 <code>/bin/bash</code> 是因为我使用的<code>shell</code>是<code>zsh</code>,而 <code>base</code> 包里本身不含有 <code>zsh</code></p></div><p>这样我们就成功切换根目录，如下</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F8F8F2;">root@M:/# ls</span></span>
<span class="line"><span style="color:#F8F8F2;">bin  </span><span style="color:#E6DB74;">boot</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">dev</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">etc</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">home</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">lib</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">lib32</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">lib64</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">libx32</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">media</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">mnt</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">opt</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">proc</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">root</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">run</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">sbin</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">srv</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">sys</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">tmp</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">usr</span><span style="color:#F8F8F2;">  </span><span style="color:#E6DB74;">var</span></span>
<span class="line"><span style="color:#F8F8F2;">root@M:/#</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>之后执行<code>apt update</code>，准备安装软件</p><p>你可能会遇到如下错误</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F8F8F2;">root@M:/# apt update</span></span>
<span class="line"><span style="color:#F8F8F2;">Get:1 </span><span style="color:#E6DB74;">http://archive.ubuntu.com/ubuntu</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">focal</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">InRelease</span><span style="color:#F8F8F2;"> [</span><span style="color:#AE81FF;">265</span><span style="color:#F8F8F2;"> kB]</span></span>
<span class="line"><span style="color:#F8F8F2;">Get:2 </span><span style="color:#E6DB74;">http://security.ubuntu.com/ubuntu</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">focal-security</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">InRelease</span><span style="color:#F8F8F2;"> [</span><span style="color:#AE81FF;">109</span><span style="color:#F8F8F2;"> kB]</span></span>
<span class="line"><span style="color:#F8F8F2;">Err:2 </span><span style="color:#E6DB74;">http://security.ubuntu.com/ubuntu</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">focal-security</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">InRelease</span></span>
<span class="line"><span style="color:#F8F8F2;">  Couldn&#39;t </span><span style="color:#E6DB74;">create</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">temporary</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">file</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">/tmp/apt.conf.HeoxFW</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">for</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">passing</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">config</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">to</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">apt-key</span></span>
<span class="line"><span style="color:#F8F8F2;">Err:1 </span><span style="color:#E6DB74;">http://archive.ubuntu.com/ubuntu</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">focal</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">InRelease</span></span>
<span class="line"><span style="color:#F8F8F2;">  Couldn&#39;t </span><span style="color:#E6DB74;">create</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">temporary</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">file</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">/tmp/apt.conf.t765yW</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">for</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">passing</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">config</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">to</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">apt-key</span></span>
<span class="line"><span style="color:#F8F8F2;">Get:3 </span><span style="color:#E6DB74;">http://archive.ubuntu.com/ubuntu</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">focal-updates</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">InRelease</span><span style="color:#F8F8F2;"> [</span><span style="color:#AE81FF;">114</span><span style="color:#F8F8F2;"> kB]</span></span>
<span class="line"><span style="color:#F8F8F2;">Err:3 </span><span style="color:#E6DB74;">http://archive.ubuntu.com/ubuntu</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">focal-updates</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">InRelease</span></span>
<span class="line"><span style="color:#F8F8F2;">  Couldn&#39;t </span><span style="color:#E6DB74;">create</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">temporary</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">file</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">/tmp/apt.conf.I7juzX</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">for</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">passing</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">config</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">to</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">apt-key</span></span>
<span class="line"><span style="color:#F8F8F2;">Get:4 </span><span style="color:#E6DB74;">http://archive.ubuntu.com/ubuntu</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">focal-backports</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">InRelease</span><span style="color:#F8F8F2;"> [</span><span style="color:#AE81FF;">101</span><span style="color:#F8F8F2;"> kB]</span></span>
<span class="line"><span style="color:#F8F8F2;">Err:4 </span><span style="color:#E6DB74;">http://archive.ubuntu.com/ubuntu</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">focal-backports</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">InRelease</span></span>
<span class="line"><span style="color:#F8F8F2;">  Couldn&#39;t </span><span style="color:#E6DB74;">create</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">temporary</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">file</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">/tmp/apt.conf.oD5jt5</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">for</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">passing</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">config</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">to</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">apt-key</span></span>
<span class="line"><span style="color:#F8F8F2;">Reading </span><span style="color:#E6DB74;">package</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">lists...</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">Done</span></span>
<span class="line"><span style="color:#F8F8F2;">W: </span><span style="color:#E6DB74;">GPG</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">error:</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">http://security.ubuntu.com/ubuntu</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">focal-security</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">InRelease:</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">Couldn&#39;t create temporary file /tmp/apt.conf.HeoxFW for passing config to apt-key</span></span>
<span class="line"><span style="color:#E6DB74;">E: The repository &#39;http://security.ubuntu.com/ubuntu</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">focal-security</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">InRelease&#39; is not signed.</span></span>
<span class="line"><span style="color:#E6DB74;">N: Updating from such a repository can&#39;t</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">be</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">done</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">securely,</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">and</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">is</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">therefore</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">disabled</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">by</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">default.</span></span>
<span class="line"><span style="color:#F8F8F2;">N: </span><span style="color:#E6DB74;">See</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">apt-secure</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">8</span><span style="color:#F8F8F2;">) </span><span style="color:#E6DB74;">manpage</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">for</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">repository</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">creation</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">and</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">user</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">configuration</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">details.</span></span>
<span class="line"><span style="color:#F8F8F2;">W: </span><span style="color:#E6DB74;">GPG</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">error:</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">http://archive.ubuntu.com/ubuntu</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">focal</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">InRelease:</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">Couldn&#39;t create temporary file /tmp/apt.conf.t765yW for passing config to apt-key</span></span>
<span class="line"><span style="color:#E6DB74;">E: The repository &#39;http://archive.ubuntu.com/ubuntu</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">focal</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">InRelease&#39; is not signed.</span></span>
<span class="line"><span style="color:#E6DB74;">N: Updating from such a repository can&#39;t</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">be</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">done</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">securely,</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">and</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">is</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">therefore</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">disabled</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">by</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">default.</span></span>
<span class="line"><span style="color:#F8F8F2;">N: </span><span style="color:#E6DB74;">See</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">apt-secure</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">8</span><span style="color:#F8F8F2;">) </span><span style="color:#E6DB74;">manpage</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">for</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">repository</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">creation</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">and</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">user</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">configuration</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">details.</span></span>
<span class="line"><span style="color:#F8F8F2;">W: </span><span style="color:#E6DB74;">GPG</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">error:</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">http://archive.ubuntu.com/ubuntu</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">focal-updates</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">InRelease:</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">Couldn&#39;t create temporary file /tmp/apt.conf.I7juzX for passing config to apt-key</span></span>
<span class="line"><span style="color:#E6DB74;">E: The repository &#39;http://archive.ubuntu.com/ubuntu</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">focal-updates</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">InRelease&#39; is not signed.</span></span>
<span class="line"><span style="color:#E6DB74;">N: Updating from such a repository can&#39;t</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">be</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">done</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">securely,</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">and</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">is</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">therefore</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">disabled</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">by</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">default.</span></span>
<span class="line"><span style="color:#F8F8F2;">N: </span><span style="color:#E6DB74;">See</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">apt-secure</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">8</span><span style="color:#F8F8F2;">) </span><span style="color:#E6DB74;">manpage</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">for</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">repository</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">creation</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">and</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">user</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">configuration</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">details.</span></span>
<span class="line"><span style="color:#F8F8F2;">W: </span><span style="color:#E6DB74;">GPG</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">error:</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">http://archive.ubuntu.com/ubuntu</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">focal-backports</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">InRelease:</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">Couldn&#39;t create temporary file /tmp/apt.conf.oD5jt5 for passing config to apt-key</span></span>
<span class="line"><span style="color:#E6DB74;">E: The repository &#39;http://archive.ubuntu.com/ubuntu</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">focal-backports</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">InRelease&#39; is not signed.</span></span>
<span class="line"><span style="color:#E6DB74;">N: Updating from such a repository can&#39;t</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">be</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">done</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">securely,</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">and</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">is</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">therefore</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">disabled</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">by</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">default.</span></span>
<span class="line"><span style="color:#F8F8F2;">N: </span><span style="color:#E6DB74;">See</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">apt-secure</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">8</span><span style="color:#F8F8F2;">) </span><span style="color:#E6DB74;">manpage</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">for</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">repository</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">creation</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">and</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">user</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">configuration</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">details.</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>这个错误是因为，当前根目录下的<code>tmp</code>目录不可写的原因，通过<code>chmod 777 ./tmp</code>就可以解决。</p><p>之后你可能会遇到如下问题</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F8F8F2;">root@M:/# apt update</span></span>
<span class="line"><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">% [Waiting </span><span style="color:#F92672;">for</span><span style="color:#F8F8F2;"> headers] [Waiting </span><span style="color:#F92672;">for</span><span style="color:#F8F8F2;"> headers]^C</span></span>
<span class="line"><span style="color:#F8F8F2;">root@M:/#</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>就是一真卡在这里不动，通过<code>rm /var/lib/apt/lists/* -rf</code>来解决。解决如上问题就可以<code>apt update</code>,之后就可以安装需要的软件了</p><ol start="3"><li>安装软件</li></ol><p>下面的软件一般是系统基础软件，还有一些是网络相关的软件</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#88846F;"># 这个是为了在安装tzdata,避免交互</span></span>
<span class="line"><span style="color:#F92672;">export</span><span style="color:#F8F8F2;"> DEBIAN_FRONTEND</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">noninteractive</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># 执行更新</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">update</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">upgrade</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">sudo</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">systemd</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">systemd-sysv</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">linux-base</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">util-linux</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">expect</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">gdisk</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">parted</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">u-boot-tools</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">file</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">findutils</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">net-tools</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">network-manager</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">iproute2</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">isc-dhcp-client</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">ethtool</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">ntp</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">wireless-tools</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">dhcpcd5</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">resolvconf</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">avahi-utils</span></span>
<span class="line"><span style="color:#F8F8F2;">apt </span><span style="color:#E6DB74;">install</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-y</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">iw</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><ol start="4"><li>配置用户</li></ol><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F8F8F2;">passwd </span><span style="color:#E6DB74;">root</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>当然也可以通过下面的指令来避免交互</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#66D9EF;">echo</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&quot;passwd&quot;</span><span style="color:#F8F8F2;"> </span><span style="color:#F92672;">|</span><span style="color:#F8F8F2;"> passwd </span><span style="color:#AE81FF;">--stdin</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">root</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这里我只配置的<code>root</code>用户，你也可以配置其他的一些普通用户。</p><ol start="5"><li>其他配置</li></ol><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F8F8F2;">rm </span><span style="color:#AE81FF;">-rf</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">/etc/hosts</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">/etc/hostname</span></span>
<span class="line"><span style="color:#F8F8F2;">touch </span><span style="color:#E6DB74;">/etc/hosts</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">/etc/hostname</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">cat </span><span style="color:#F92672;">&lt;&lt;-</span><span style="color:#E6DB74;">EOF &gt; /etc/hostname</span></span>
<span class="line"><span style="color:#E6DB74;">	</span><span style="color:#F8F8F2;">$HOSTNAME</span></span>
<span class="line"><span style="color:#E6DB74;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">cat </span><span style="color:#F92672;">&lt;&lt;-</span><span style="color:#E6DB74;">EOF &gt; /etc/hosts</span></span>
<span class="line"><span style="color:#E6DB74;">    127.0.0.1 localhost</span></span>
<span class="line"><span style="color:#E6DB74;">    127.0.1.1 </span><span style="color:#F8F8F2;">$HOSTNAME</span></span>
<span class="line"><span style="color:#E6DB74;">    # The following lines are desirable for IPv6 capable hosts</span></span>
<span class="line"><span style="color:#E6DB74;">    #::1     localhost ip6-localhost ip6-loopback</span></span>
<span class="line"><span style="color:#E6DB74;">    #fe00::0 ip6-localnet</span></span>
<span class="line"><span style="color:#E6DB74;">    #ff00::0 ip6-mcastprefix</span></span>
<span class="line"><span style="color:#E6DB74;">    #ff02::1 ip6-allnodes</span></span>
<span class="line"><span style="color:#E6DB74;">    #ff02::2 ip6-allrouters</span></span>
<span class="line"><span style="color:#E6DB74;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">chown </span><span style="color:#E6DB74;">root:root</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">/usr/bin/sudo</span></span>
<span class="line"><span style="color:#F8F8F2;">chmod </span><span style="color:#AE81FF;">4755</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">/usr/bin/sudo</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ol start="6"><li>打包rootfs.img</li></ol><p>通过下面的指令，我们就可以将前面制作的rootfs放到<code>rootfs.img</code>中。</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F8F8F2;">rootfssize</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">1024M</span></span>
<span class="line"><span style="color:#F8F8F2;">rootfsimg</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">rootfs.img</span></span>
<span class="line"><span style="color:#F8F8F2;">rootfstmp</span><span style="color:#F92672;">=</span><span style="color:#E6DB74;">rtmp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># 创建img文件</span></span>
<span class="line"><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> [ </span><span style="color:#F92672;">-f</span><span style="color:#F8F8F2;">  $rootfsimg ];</span><span style="color:#F92672;">then</span></span>
<span class="line"><span style="color:#F8F8F2;">	rm </span><span style="color:#AE81FF;">-rf</span><span style="color:#F8F8F2;"> $rootfsimg</span></span>
<span class="line"><span style="color:#F92672;">fi</span></span>
<span class="line"><span style="color:#F8F8F2;">dd </span><span style="color:#E6DB74;">if=/dev/zero</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">of=</span><span style="color:#F8F8F2;">$rootfsimg </span><span style="color:#E6DB74;">bs=</span><span style="color:#F8F8F2;">$rootfssize </span><span style="color:#E6DB74;">count=</span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">status=progress</span></span>
<span class="line"><span style="color:#F92672;">if</span><span style="color:#F8F8F2;"> [ </span><span style="color:#F92672;">-d</span><span style="color:#F8F8F2;">  $rootfstmp ];</span><span style="color:#F92672;">then</span></span>
<span class="line"><span style="color:#F8F8F2;">	rm </span><span style="color:#AE81FF;">-rf</span><span style="color:#F8F8F2;"> $rootfstmp</span></span>
<span class="line"><span style="color:#F92672;">fi</span></span>
<span class="line"><span style="color:#88846F;"># 创建临时挂载目录</span></span>
<span class="line"><span style="color:#F8F8F2;">mkdir $rootfstmp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">mkfs.ext4 $rootfsimg</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># 挂载img</span></span>
<span class="line"><span style="color:#F8F8F2;">mount </span><span style="color:#AE81FF;">-t</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">ext4</span><span style="color:#F8F8F2;"> $rootfsimg $rootfstmp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;"># 复制文件到</span></span>
<span class="line"><span style="color:#F8F8F2;">cp </span><span style="color:#AE81FF;">-rf</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">./base/</span><span style="color:#FD971F;">*</span><span style="color:#F8F8F2;"> $rootfstmp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">umount $rootfstmp</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="_3-测试" tabindex="-1">3. 测试 <a class="header-anchor" href="#_3-测试" aria-hidden="true">#</a></h2><p>我们使用<code>qemu</code>来测试，命令和参数如下：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F8F8F2;">qemu-system-x86_64 </span><span style="color:#AE81FF;">\\</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#AE81FF;">--enable-kvm</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">-m</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">1024</span><span style="color:#F8F8F2;">  </span><span style="color:#AE81FF;">-smp</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">1</span><span style="color:#AE81FF;">\\</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#AE81FF;">-kernel</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">./x86_64-build-out/arch/x86_64/boot/bzImage</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">\\</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#AE81FF;">-hda</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">../rootfs/rootfs.img</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">\\</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#AE81FF;">-nographic</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">\\</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#AE81FF;">-net</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">nic,model=e1000,netdev=m</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">\\</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#AE81FF;">-netdev</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">tap,ifname=tap0,script=no,downscript=no,id=m</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">\\</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#AE81FF;">-append</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">&quot;root=/dev/sda console=ttyS0 rootfstype=ext4 rw  &quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>根据你自己的环境修改你的参数配置,最好可以把它放到一个脚本中，因为这个命令实在是参数太多，方便修改,我这里放到<code>setup-qemu.sh</code>,另外命令中<code>net</code>的参数是为了我们在启动之后可能有网络使用，所以我这里加入一个tap0虚拟网卡，启动虚拟网卡，可以通过下面的指令：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki monokai"><code><span class="line"><span style="color:#F8F8F2;">sudo </span><span style="color:#E6DB74;">brctl</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">addbr</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">br0</span></span>
<span class="line"><span style="color:#F8F8F2;">sudo </span><span style="color:#E6DB74;">brctl</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">addif</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">br0</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">enp4s0</span></span>
<span class="line"><span style="color:#F8F8F2;">sudo </span><span style="color:#E6DB74;">ifconfig</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">enp4s0</span><span style="color:#F8F8F2;"> </span><span style="color:#AE81FF;">0</span></span>
<span class="line"><span style="color:#F8F8F2;">sudo </span><span style="color:#E6DB74;">dhclient</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">br0</span></span>
<span class="line"><span style="color:#F8F8F2;">sudo </span><span style="color:#E6DB74;">ip</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">tuntap</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">add</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">dev</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">tap0</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">mode</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">tap</span></span>
<span class="line"><span style="color:#F8F8F2;">sudo </span><span style="color:#E6DB74;">brctl</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">addif</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">br0</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">tap0</span></span>
<span class="line"><span style="color:#F8F8F2;">sudo </span><span style="color:#E6DB74;">ip</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">link</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">set</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">dev</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">tap0</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">up</span></span>
<span class="line"><span style="color:#F8F8F2;">sudo </span><span style="color:#E6DB74;">ifconfig</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">tap0</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">192.168.122.123</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">netmask</span><span style="color:#F8F8F2;"> </span><span style="color:#E6DB74;">192.168.122.255</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>其中<code>enp4s0</code> 是我的物理网卡，你修改成你自己的网卡,下面是测试的结果</p><p><img src="`+t+'" alt="test" title="test result"></p><p>注意</p><ul><li>在视频最后会出现<code>hostname login: qemu-system-x86_64: terminating on signal 15 from pid 228717 (/bin/zsh)</code>这不是系统异常通过，而我从为了录制的需要，从另外一个终端<code>kill</code>掉了。</li></ul><h2 id="_4-小结" tabindex="-1">4. 小结 <a class="header-anchor" href="#_4-小结" aria-hidden="true">#</a></h2><p>从上面的过程来看，制作一个基于<code>ubuntu base</code>的包之后，我们几乎就拥有了一个相对完整的系统，即使一些工具没有，也可以通过<code>apt install</code>来安装，甚至你可以安装 <a href="https://www.suckless.org" target="_blank" rel="noreferrer">DWM</a>这种窗口管理系统，成为一个真正的系统。</p><hr><div class="tip custom-block"><p class="custom-block-title">Tip</p><p>欢迎评论、探讨,如果发现错误请指正。转载请注明出处！ <a href="http://www.tsz.wiki" target="_blank" rel="noreferrer">探索者</a></p></div><hr>',56)),c(a,{title:n.$title},null,8,["title"])])}const B=l(F,[["render",y]]);export{D as __pageData,B as default};
